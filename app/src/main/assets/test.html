<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>CRL_NATIVE_TEST</title>

<script>

    function LingyuSDK(){
        this.name="lingyu";
        this.version=1.0;
    }
    LingyuSDK.NativeBackMap={};
    LingyuSDK.NativeCall=function(key,value){
        var str=JSON.stringify(value);
        log("call phoneSDK:"+key);
        var error;
        try{
            phone.nativeCall(key,str);
            return;
        }catch(e){
           error=e;
        }

        try{
            str=JSON.stringify({'key':key,'value':value});
            window.external.notify(str);
            return;
        }catch(e){
            error=e;
        }


        if(error){
            log("it's need phoneSDK!"+error);
        }
    }

    LingyuSDK.SetNativeBack=function(key,handle){
        LingyuSDK.NativeBackMap[key]=handle;
    }

    LingyuSDK.NativeBack=function(key,value){
        log("NativeBack:"+key+","+value);
        var f=LingyuSDK.NativeBackMap[key];
        if(f){
            var dic="";
            try {
                //data有可能不是合法的JSON字符串，便会产生异常
                dic = JSON.parse(value);
            } catch (e) {
                dic = value;
            }

            f(dic);
        }else{
            alert("NativeBack:"+key+","+value);
        }
    }

    LingyuSDK.DoInit=function(){
        LingyuSDK.NativeCall("doInit","");
    }

    LingyuSDK.DoLogin=function(f){
        LingyuSDK.SetNativeBack("doLogin",f);
        LingyuSDK.NativeCall("doLogin","");
    }

    LingyuSDK.DoPay=function(value){
        LingyuSDK.NativeCall("doPay",value);
    }
    function log(msg) {
        document.getElementById("log").innerHTML+=msg+"<br/>"
    }


    function login(){
        LingyuSDK.DoLogin(function (o) {
             var userID=o.uid;
              alert("loginBack:"+userID);
        });
    }



    function recharge(){
        LingyuSDK.DoPay({
            'rmb':'520',
            'extra':'ss',
            'notifyurl':'http://aa.bb.com' 
        });
    }


    //Win 微软的返回值
    function MG_CallBack(account,id,token){
        alert(account+"-"+id+"-"+token);
    }
    function MG_PayBack(o){
        var value=JSON.parse(o);
    }

</script>

</head>

<body>
    <div><button style="width: 100%; height: 50px;"  onclick="login()">登录</button></div>
    <div><button style="width: 100%; height: 50px;"  onclick="recharge()">充值</button></div>
    <div id="log" />
</body>
</html>